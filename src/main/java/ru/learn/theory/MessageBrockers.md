# Message brokers

### Разница между Kafka и RabbitMq
- созданы для разных целей, не совсем верно сравнивать лучше/хуже. Kafka горизонтально масштабируемая, крутой механизм обработки большого количества сообщений. RabbitMq же более классический Pub/Sub. Kafka - для событийности или переноса данных. RabbitMq хорош для запросов внутри сервисов
- RabbitMq не хранит сообщения после того как отдаст их слушателям
- RabbitMq обладает маршрутизацией, может сам определять кому направить сообщение
- RabbitMq хуже масштабируется

## KAFKA

Порядок чтения и записи в/из партиции топика **случайны!**

### Гарантия доставки у Kafka
- **At-most-once (“как максимум однократная доставка”)** сообщение не может быть доставлено больше одного раза. При этом сообщение может быть потеряно.
- **At-least-once (“как минимум однократная доставка”)**. сообщение никогда не будет потеряно. При этом сообщение может быть доставлено более одного раза. Достигается ретраями и подтверждениями.  DeadLetterQueue
- **Exactly-once (“строго однократная доставка”)**. Все сообщения доставляются строго единожды. Достигается логикой на коньсьюмере

Коньсьюмер считается **ИДЕМПОТЕНТНЫМ** тогда, когда в нем есть логика позволяющая работать с дубликатами так, как будто это всегда было одно сообщение. При гарантии доставки At-least-once в коньсьюмер могут прилетать дубли сообщений. Много способов для реализации идемпотентности

За счет чего достигаются гарантии? 
 - внутренние механизмы кафки
 - система ретраев