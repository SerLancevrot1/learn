### База
#### Шаг 1: понять задачу и определить масштаб решения
Вот список вопросов, с которых можно начать:
- Какие именно возможности мы будем реализовывать?
- Сколько пользователей у нашего продукта?
- Как скоро ожидается наращивание мощностей? Какой масштаб планируется через 3 месяца, полгода, год?
- Как выглядит технологический стек компании? Какие существующие сервисы можно применить для упрощения архитектуры?

#### Шаг 2: предложить общее решение и получить согласие
Очень желательно в ходе этого процесса наладить совместную работу
- Предложите начальный план архитектуры. Поинтересуйтесь мнением интервьюера. Относитесь к нему как к члену своей команды, с которым вы вместе работаете. Хорошие интервьюеры зачастую любят поговорить и поучаствовать в решении задачи
- Нарисуйте на доске или бумаге блок-схемы с ключевыми компонентами, такими как клиенты (мобильные/браузерные), API-интерфейсы, веб-серверы, хранилища данных, кэши, CDN, очереди сообщений и т. д.
- Выполните приблизительные расчеты, чтобы понять, соответствует ли ваше решение масштабу задачи. Рассуждайте вслух. Прежде чем что-то считать, пообщайтесь с интервьюером
- По возможности пройдитесь по нескольким конкретным сценариям использования. Это поможет вам сформировать общую архитектуру и, скорее всего, обнаружить крайние случаи, о которых вы еще не думали
- Следует ли на этом этапе обозначать конечные точки API-интерфейса и схему базы данных? Это зависит от задачи. Если вас просят спроектировать что-то масштабное, такое как поиск Google, то лучше не углубляться настолько сильно. Если же речь идет о серверной части многопользовательской игры в покер, эти аспекты вполне можно указать. Общайтесь с интервьюером.

#### Шаг 3: глубокое погружение в проектирование
На этом этапе вы и интервьюер достигли следующих целей:
- согласовали общие требования и будущий масштаб
- начертили примерную схему архитектуры
- узнали мнение интервьюера о вашем общем решении
- получили какое-то базовое представление о том, на каких областях нужно сосредоточиться при подробном проектировании (исходя из того, что ответил интервьюер).

#### Шаг 4: подведение итогов
- Интервьюер может попросить вас обозначить узкие места системы и обсудить потенциальные улучшения. Никогда не утверждайте, что ваше решение идеальное. Всегда можно что-то улучшить. Это отличная возможность продемонстрировать свое критическое мышление и оставить о себе хорошее впечатление.
- Возможно, стоит провести краткий обзор вашей архитектуры, особенно если вы предложили несколько решений. Это позволит интервьюеру освежить память, что может пригодиться после длинного собеседования.
- Будет интересно поговорить о внештатных ситуациях, таких как поломка серверов, разрыв сети и т. д.
- Стоит затронуть эксплуатационные вопросы. Как вы отслеживаете метрики и журналы ошибок? Как выкатывается система?
- Проведение следующего этапа масштабирования — тоже весьма интересная тема. Например, если ваша текущая архитектура поддерживает 1 миллион пользователей, какие изменения нужно внести, чтобы увеличить эту цифру до 10 миллионов?
- Если еще остается время, предложите дальнейшие улучшения

#### Время, выделяемое на каждый этап
Примерные расчеты: 
- Шаг 1. Понять задачу и определить масштаб: 3–10 минут.
- Шаг 2. Предложить общее решение и получить одобрение: 10–15 минут.
- Шаг 3. Подробное проектирование: 10–25 минут.
- Шаг 4. Подведение итогов: 3–5 минут.


### Степени двойки
В распределенных системах данные могут достигать огромных размеров, но все вычисления сводятся к элементарным свойствам. Чтобы получить правильный результат, нужно обязательно знать объем данных, используя вторую степень. Байт — это последовательность из 8 бит. Символ ASCII занимает в памяти один байт (8 бит)

| Степень | Примерное значение | Полное название | Сокращенное обозначение |
|---------|--------------------|-----------------|-------------------------|
| 10      | 1 тысяча           | 1 килобайт      | 1 КБ                    |
| 20      | 1 миллион          | 1 мегабайт      | 1 МБ                    |
| 30      | 1 миллиард         | 1 гигабайт      | 1 ГБ                    |
| 40      | 1 триллион         | 1 терабайт      | 1 ТБ                    |
| 50      | 1 квадриллион      | 1 петабайт      | 1 ПБ                    |

### ПОКАЗАТЕЛИ ЛАТЕНТНОСТИ

нс = наносекунда, мкс = микросекунда, мс = миллисекунда

* 1 нс = 10^-9 секунд
* 1 мкс = 10^-6 секунд = 1000 нс
* 1 мс = 10^-3 секунд = 1000 мкс = 1 000 000 нс

| Название операции                                    | Время                   |
|------------------------------------------------------|-------------------------|
| Обращение к кэшу L1                                  | 0,5 нс                  |
| Ошибочное предсказание перехода                      | 5 нс                    |
| Обращение к кэшу L2                                  | 7 нс                    |
| Блокирование/разблокирование мьютекса                | 100 нс                  |
| Обращение к основной памяти                          | 100 нс                  |
| Сжатие 1 Кб с помощью Zippy                          | 10 000 нс = 10 мкс      |
| Отправка 2 Кб по сети 1 Гбит/с                       | 20 000 нс = 20 мкс      |
| Последовательное чтение из памяти 1 Мб               | 250 000 нс = 250 мкс    |
| Перемещение пакета туда и обратно внутри одного ЦОД  | 500 000 нс = 500 мкс    |
| Время поиска по диску                                | 10 000 000 нс = 10 мс   |
| Последовательное чтение 1 Мб из сети                 | 10 000 000 нс = 10 мс   |
| Последовательное чтение 1 Мб с диска                 | 30 000 000 нс = 30 мс   |
| Передача пакета из Калифорнии в Нидерланды и обратно | 150 000 000 нс = 150 мс |

* память быстрая, а диск медленный;
* по возможности следует избегать поиска по диску;
* простые алгоритмы сжатия отличаются высокой скоростью;
* прежде чем отправлять данные по интернету, их по возможности нужно сжимать;
* центры обработки данных обычно находятся в разных регионах, и передача информации между ними занимает время.

### ПОКАЗАТЕЛИ ДОСТУПНОСТИ

Высокая доступность — это способность системы долго и непрерывно находиться в рабочем состоянии. Она измеряется в процентах. 100 % означает,
что сервис никогда не простаивает. У большинства сервисов доступность варьируется от 99 % и 100 %.

| Доступность | Суточный простой    | Недельный простой   | Месячный простой | Годичный простой |
|-------------|---------------------|---------------------|------------------|------------------|
| 99 %        | 14,40 минуты        | 1,68 часа           | 7,31 часа        | 3,65 дня         |
| 99,9 %      | 1,44 минуты         | 10,08 минуты        | 43,83 минуты     | 8,77 часа        |
| 99,99 %     | 8,64 секунды        | 1,01 минуты         | 4,38 минуты      | 52,60 минуты     |
| 99,999 %    | 864,00 миллисекунды | 6,05 секунды        | 26,30 секунды    | 5,26 минуты      |
| 99,9999 %   | 86,40 миллисекунды  | 604,80 миллисекунды | 2,63 секунды     | 31,56 секунды    |

### ПРИМЕР: ОЦЕНКА ТРЕБОВАНИЙ

Предположения:
* 300 миллионов активных пользователей в месяц;
* 50 % из них пользуются Twiter ежедневно;
* пользователи в среднем публикуют по 2 твита в день;
* 100 % твитов содержат медиаданные;
* данные хранятся на протяжении 5 лет.

  Оценки:
* ежедневные активные пользователи (daily active users, DAU) = 300 миллионов * 50 % = 150 миллионов;
* запросов в секунду (queries per second, QPS) = 150 миллионов * 2 твита / 24 часа / 3600 секунд = ~3500;
* пиковый показатель QPS = 2 * QPS = ~7000.

  Здесь мы оценим лишь место, необходимое для хранения данных:
  средний размер твита:
* tweet_id — 64 байта;
* текст — 140 байтов;
* медиаданные — 1 Мб;
* объем данных: 150 миллионов * 2 * 10% * 1 Мб = 30 Тб в день;
* объем данных за 5 лет: 30 Тб * 365 * 5 = ~55 Пб.